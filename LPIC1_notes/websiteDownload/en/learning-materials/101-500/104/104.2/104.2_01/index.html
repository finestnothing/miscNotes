

<!DOCTYPE html>
<html lang="en-us">
<head>


  
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-WMC4KTP');</script>
  



  <meta charset="utf-8"/>
  <title>104.2 Lesson 1</title>

  <link rel="stylesheet" href="../../../../../../scss/styles.min.css">

  
  <link rel="apple-touch-icon" sizes="152x152" href="https://learning.lpi.org/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://learning.lpi.org/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://learning.lpi.org/favicon-16x16.png">
  <link rel="manifest" href="https://learning.lpi.org/site.webmanifest">
  <link rel="mask-icon" href="https://learning.lpi.org/safari-pinned-tab.svg" color="#fbc000">
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="theme-color" content="#ffffff">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body class="page">



  
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WMC4KTP"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  



  

<header class="header">
  <span class="header__nav -clone"></span>

  <a href="https://learning.lpi.org/" class="header__logo-link">
    <img class="header__logo" src="../../../../../../lpi-learning-logo.svg" alt="Linux Professional Institute Learning Logo.">
  </a>

  <nav class="header__nav nav">
    <a href="index.html#content" class="nav__skip">Skip to main content</a>

    <button class="nav__button" aria-hidden="true">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <div class="nav__menus">
      <ul class="nav__menu">
        
          <li class="nav__item
              
              
              ">


            
              <a href="https://learning.lpi.org/en/" class="nav__link">Home</a>
            


            
          </li>
        
          <li class="nav__item
              -has-submenu
              -is-active
              ">


            
              <button class="nav__link" type="button">Learning Materials</button>
            


            
              <ul class="nav__menu -submenu">
                
                  <li class="nav__item
                      ">
                    <a href="https://learning.lpi.org/en/learning-materials/all-materials/" class="nav__link
                      ">All Resources</a>
                  </li>
                
                  <li class="nav__item
                      ">
                    <a href="https://learning.lpi.org/en/learning-materials/learning-materials/" class="nav__link
                      ">LPI Learning Materials</a>
                  </li>
                
                  <li class="nav__item
                      ">
                    <a href="https://learning.lpi.org/en/learning-materials/become-contributor/" class="nav__link
                      ">Become a Contributor</a>
                  </li>
                
              </ul>
            
          </li>
        
          <li class="nav__item
              -has-submenu
              
              ">


            
              <button class="nav__link" type="button">Publishing Partners</button>
            


            
              <ul class="nav__menu -submenu">
                
                  <li class="nav__item
                      ">
                    <a href="https://learning.lpi.org/en/lpi-publishing-partner/lpp-partners/" class="nav__link
                      ">Publishing Partners</a>
                  </li>
                
                  <li class="nav__item
                      ">
                    <a href="https://learning.lpi.org/en/lpi-publishing-partner/become-lpp/" class="nav__link
                      ">Become a Publishing Partner</a>
                  </li>
                
              </ul>
            
          </li>
        
          <li class="nav__item
              -has-submenu
              
              ">


            
              <button class="nav__link" type="button">About</button>
            


            
              <ul class="nav__menu -submenu">
                
                  <li class="nav__item
                      ">
                    <a href="https://learning.lpi.org/en/about/about/" class="nav__link
                      ">About</a>
                  </li>
                
                  <li class="nav__item
                      ">
                    <a href="https://learning.lpi.org/en/about/faq/" class="nav__link
                      ">FAQ</a>
                  </li>
                
                  <li class="nav__item
                      ">
                    <a href="https://learning.lpi.org/en/about/lm-contributors/" class="nav__link
                      ">Contributors</a>
                  </li>
                
                  <li class="nav__item
                      ">
                    <a href="https://learning.lpi.org/en/about/roadmap/" class="nav__link
                      ">Roadmap</a>
                  </li>
                
                  <li class="nav__item
                      ">
                    <a href="https://learning.lpi.org/en/about/contact/" class="nav__link
                      ">Contact</a>
                  </li>
                
              </ul>
            
          </li>
        
      </ul>

      <ul class="nav__menu -secondary">
        <li class="nav__item -lang-select">
        
<select name="language-picker" id="lang-select" class="lang-select" title='Language' aria-label='Language'>
  
    <option value="es"
      >Español</option>
  
    <option value="de"
      >Deutsch</option>
  
    <option value="en"
      selected>English</option>
  
    <option value="it"
      >Italiano</option>
  
    <option value="pt"
      >Português</option>
  
</select>


        </li>
        <li class="nav__item -external">
        <a href="https://lpi.org/" class="nav__link" target="_blank" rel="noreferrer noopener">LPI.org</a>
        </li>
      </ul>
    </div>
  </nav>
</header>


  <table class="print-header">
    <tr class="print-header__body">
      <td class="print-header__cell">104.2 Lesson 1</td>
      <td class="print-header__cell -pagenumber"></td>
    </tr>
  </table>

  <table class="print">
    <thead><tr><td class="print__cell">
      <div class="print__space -header"></div>
    </td></tr></thead>
    <tbody><tr><td class="print__cell">
      <main id="content">




<div class="lesson page-content">
  <div class="lesson__hierarchy page-content__hierarchy">
    <nav class="hierarchy">
  

  <div class="hierarchy__container">
     
      <dl class="hierarchy__section">
        <dt class="hierarchy__heading">Topic 101: System Architecture
          <button class="hierarchy__toggle-button" aria-hidden="true">
            <span class="hierarchy__toggle-button__icon"></span>
          </button>
        </dt>

        
        <dd class="hierarchy__item">
          <a href="../../../101/101.1/index.html" class="hierarchy__link">101.1 Determine and configure hardware settings</a>

          <ul class="hierarchy__section -sub">
            
            <li class="hierarchy__item">
              <a href="../../../101/101.1/101.1_01/index.html" class="hierarchy__link">101.1 Lesson 1</a>
            </li>
            
          </ul>
        </dd>
        
        <dd class="hierarchy__item">
          <a href="../../../101/101.2/index.html" class="hierarchy__link">101.2 Boot the system</a>

          <ul class="hierarchy__section -sub">
            
            <li class="hierarchy__item">
              <a href="../../../101/101.2/101.2_01/index.html" class="hierarchy__link">101.2 Lesson 1</a>
            </li>
            
          </ul>
        </dd>
        
        <dd class="hierarchy__item">
          <a href="../../../101/101.3/index.html" class="hierarchy__link">101.3 Change runlevels / boot targets and shutdown or reboot system</a>

          <ul class="hierarchy__section -sub">
            
            <li class="hierarchy__item">
              <a href="../../../101/101.3/101.3_01/index.html" class="hierarchy__link">101.3 Lesson 1</a>
            </li>
            
          </ul>
        </dd>
        
      </dl>
      
      <dl class="hierarchy__section">
        <dt class="hierarchy__heading">Topic 102: Linux Installation and Package Management
          <button class="hierarchy__toggle-button" aria-hidden="true">
            <span class="hierarchy__toggle-button__icon"></span>
          </button>
        </dt>

        
        <dd class="hierarchy__item">
          <a href="../../../102/102.1/index.html" class="hierarchy__link">102.1 Design hard disk layout</a>

          <ul class="hierarchy__section -sub">
            
            <li class="hierarchy__item">
              <a href="../../../102/102.1/102.1_01/index.html" class="hierarchy__link">102.1 Lesson 1</a>
            </li>
            
          </ul>
        </dd>
        
        <dd class="hierarchy__item">
          <a href="../../../102/102.2/index.html" class="hierarchy__link">102.2 Install a boot manager</a>

          <ul class="hierarchy__section -sub">
            
            <li class="hierarchy__item">
              <a href="../../../102/102.2/102.2_01/index.html" class="hierarchy__link">102.2 Lesson 1</a>
            </li>
            
          </ul>
        </dd>
        
        <dd class="hierarchy__item">
          <a href="../../../102/102.3/index.html" class="hierarchy__link">102.3 Manage shared libraries</a>

          <ul class="hierarchy__section -sub">
            
            <li class="hierarchy__item">
              <a href="../../../102/102.3/102.3_01/index.html" class="hierarchy__link">102.3 Lesson 1</a>
            </li>
            
          </ul>
        </dd>
        
        <dd class="hierarchy__item">
          <a href="../../../102/102.4/index.html" class="hierarchy__link">102.4 Use Debian package management</a>

          <ul class="hierarchy__section -sub">
            
            <li class="hierarchy__item">
              <a href="../../../102/102.4/102.4_01/index.html" class="hierarchy__link">102.4 Lesson 1</a>
            </li>
            
          </ul>
        </dd>
        
        <dd class="hierarchy__item">
          <a href="../../../102/102.5/index.html" class="hierarchy__link">102.5 Use RPM and YUM package management</a>

          <ul class="hierarchy__section -sub">
            
            <li class="hierarchy__item">
              <a href="../../../102/102.5/102.5_01/index.html" class="hierarchy__link">102.5 Lesson 1</a>
            </li>
            
          </ul>
        </dd>
        
        <dd class="hierarchy__item">
          <a href="../../../102/102.6/index.html" class="hierarchy__link">102.6 Linux as a virtualization guest</a>

          <ul class="hierarchy__section -sub">
            
            <li class="hierarchy__item">
              <a href="../../../102/102.6/102.6_01/index.html" class="hierarchy__link">102.6 Lesson 1</a>
            </li>
            
          </ul>
        </dd>
        
      </dl>
      
      <dl class="hierarchy__section">
        <dt class="hierarchy__heading">Topic 103: GNU and Unix Commands
          <button class="hierarchy__toggle-button" aria-hidden="true">
            <span class="hierarchy__toggle-button__icon"></span>
          </button>
        </dt>

        
        <dd class="hierarchy__item">
          <a href="../../../103/103.1/index.html" class="hierarchy__link">103.1 Work on the command line</a>

          <ul class="hierarchy__section -sub">
            
            <li class="hierarchy__item">
              <a href="../../../103/103.1/103.1_01/index.html" class="hierarchy__link">103.1 Lesson 1</a>
            </li>
            
            <li class="hierarchy__item">
              <a href="../../../103/103.1/103.1_02/index.html" class="hierarchy__link">103.1 Lesson 2</a>
            </li>
            
          </ul>
        </dd>
        
        <dd class="hierarchy__item">
          <a href="../../../103/103.2/index.html" class="hierarchy__link">103.2 Process text streams using filters</a>

          <ul class="hierarchy__section -sub">
            
            <li class="hierarchy__item">
              <a href="../../../103/103.2/103.2_01/index.html" class="hierarchy__link">103.2 Lesson 1</a>
            </li>
            
          </ul>
        </dd>
        
        <dd class="hierarchy__item">
          <a href="../../../103/103.3/index.html" class="hierarchy__link">103.3 Perform basic file management</a>

          <ul class="hierarchy__section -sub">
            
            <li class="hierarchy__item">
              <a href="../../../103/103.3/103.3_01/index.html" class="hierarchy__link">103.3 Lesson 1</a>
            </li>
            
            <li class="hierarchy__item">
              <a href="../../../103/103.3/103.3_02/index.html" class="hierarchy__link">103.3 Lesson 2</a>
            </li>
            
          </ul>
        </dd>
        
        <dd class="hierarchy__item">
          <a href="../../../103/103.4/index.html" class="hierarchy__link">103.4 Use streams, pipes and redirects</a>

          <ul class="hierarchy__section -sub">
            
            <li class="hierarchy__item">
              <a href="../../../103/103.4/103.4_01/index.html" class="hierarchy__link">103.4 Lesson 1</a>
            </li>
            
            <li class="hierarchy__item">
              <a href="../../../103/103.4/103.4_02/index.html" class="hierarchy__link">103.4 Lesson 2</a>
            </li>
            
          </ul>
        </dd>
        
        <dd class="hierarchy__item">
          <a href="../../../103/103.5/index.html" class="hierarchy__link">103.5 Create, monitor and kill processes</a>

          <ul class="hierarchy__section -sub">
            
            <li class="hierarchy__item">
              <a href="../../../103/103.5/103.5_01/index.html" class="hierarchy__link">103.5 Lesson 1</a>
            </li>
            
            <li class="hierarchy__item">
              <a href="../../../103/103.5/103.5_02/index.html" class="hierarchy__link">103.5 Lesson 2</a>
            </li>
            
          </ul>
        </dd>
        
        <dd class="hierarchy__item">
          <a href="../../../103/103.6/index.html" class="hierarchy__link">103.6 Modify process execution priorities</a>

          <ul class="hierarchy__section -sub">
            
            <li class="hierarchy__item">
              <a href="../../../103/103.6/103.6_01/index.html" class="hierarchy__link">103.6 Lesson 1</a>
            </li>
            
          </ul>
        </dd>
        
        <dd class="hierarchy__item">
          <a href="../../../103/103.7/index.html" class="hierarchy__link">103.7 Search text files using regular expressions</a>

          <ul class="hierarchy__section -sub">
            
            <li class="hierarchy__item">
              <a href="../../../103/103.7/103.7_01/index.html" class="hierarchy__link">103.7 Lesson 1</a>
            </li>
            
            <li class="hierarchy__item">
              <a href="../../../103/103.7/103.7_02/index.html" class="hierarchy__link">103.7 Lesson 2</a>
            </li>
            
          </ul>
        </dd>
        
        <dd class="hierarchy__item">
          <a href="../../../103/103.8/index.html" class="hierarchy__link">103.8 Basic file editing</a>

          <ul class="hierarchy__section -sub">
            
            <li class="hierarchy__item">
              <a href="../../../103/103.8/103.8_01/index.html" class="hierarchy__link">103.8 Lesson 1</a>
            </li>
            
          </ul>
        </dd>
        
      </dl>
      
      <dl class="hierarchy__section -is-active">
        <dt class="hierarchy__heading">Topic 104: Devices, Linux Filesystems, Filesystem Hierarchy Standard
          <button class="hierarchy__toggle-button" aria-hidden="true">
            <span class="hierarchy__toggle-button__icon"></span>
          </button>
        </dt>

        
        <dd class="hierarchy__item">
          <a href="../../104.1/index.html" class="hierarchy__link">104.1 Create partitions and filesystems</a>

          <ul class="hierarchy__section -sub">
            
            <li class="hierarchy__item">
              <a href="../../104.1/104.1_01/index.html" class="hierarchy__link">104.1 Lesson 1</a>
            </li>
            
          </ul>
        </dd>
        
        <dd class="hierarchy__item">
          <a href="../index.html" class="hierarchy__link">104.2 Maintain the integrity of filesystems</a>

          <ul class="hierarchy__section -sub">
            
            <li class="hierarchy__item">
              <a href="index.html" class="hierarchy__link">104.2 Lesson 1</a>
            </li>
            
          </ul>
        </dd>
        
        <dd class="hierarchy__item">
          <a href="../../104.3/index.html" class="hierarchy__link">104.3 Control mounting and unmounting of filesystems</a>

          <ul class="hierarchy__section -sub">
            
            <li class="hierarchy__item">
              <a href="../../104.3/104.3_01/index.html" class="hierarchy__link">104.3 Lesson 1</a>
            </li>
            
          </ul>
        </dd>
        
        <dd class="hierarchy__item">
          <a href="../../104.5/index.html" class="hierarchy__link">104.5 Manage file permissions and ownership</a>

          <ul class="hierarchy__section -sub">
            
            <li class="hierarchy__item">
              <a href="../../104.5/104.5_01/index.html" class="hierarchy__link">104.5 Lesson 1</a>
            </li>
            
          </ul>
        </dd>
        
        <dd class="hierarchy__item">
          <a href="../../104.6/index.html" class="hierarchy__link">104.6 Create and change hard and symbolic links</a>

          <ul class="hierarchy__section -sub">
            
            <li class="hierarchy__item">
              <a href="../../104.6/104.6_01/index.html" class="hierarchy__link">104.6 Lesson 1</a>
            </li>
            
          </ul>
        </dd>
        
        <dd class="hierarchy__item">
          <a href="../../104.7/index.html" class="hierarchy__link">104.7 Find system files and place files in the correct location</a>

          <ul class="hierarchy__section -sub">
            
            <li class="hierarchy__item">
              <a href="../../104.7/104.7_01/index.html" class="hierarchy__link">104.7 Lesson 1</a>
            </li>
            
          </ul>
        </dd>
        
      </dl>
      
  </div>
</nav>

  </div>



  <div class="lesson__container page-content__container">
    <div class="container">
      <nav class="lesson__breadcrumb breadcrumb">
        <ol class="breadcrumb__list">
          
          <li class="breadcrumb__item">
            <a href="../../index.html" class="breadcrumb__link">Topic 104: Devices, Linux Filesystems, Filesystem Hierarchy Standard</a>
          </li>
          
          
          <li class="breadcrumb__item">
            <a href="../index.html" class="breadcrumb__link">104.2 Maintain the integrity of filesystems</a>
          </li>
          
          <li class="breadcrumb__item">
            <a href="index.html" class="breadcrumb__link">104.2 Lesson 1</a>
          </li>
        </ol>
      </nav>

      
      <section class="lesson__content">
        
          <h1>104.2 Lesson 1</h1>
          <div id="preamble">
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch fronttable">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Certificate:</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">LPIC-1</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Version:</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.0</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Topic:</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">104 Devices, Linux Filesystems, Filesystem Hierarchy Standard</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Objective:</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">104.2 Maintain the integrity of filesystems</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Lesson:</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 of 1</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="sec.104.2_01-IN">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Modern Linux filesystems are journaled. This means that every operation is registered in an internal log (the <em>journal</em>) before it is executed. If the operation is interrupted due to a system error (like a kernel panic, power failure, etc.) it can be reconstructed by checking the journal, avoiding filesystem corruption and loss of data.</p>
</div>
<div class="paragraph">
<p>This greatly reduces the need for manual filesystem checks, but they may still be needed. Knowing the tools used for this (and the corresponding parameters) may represent the difference between dinner at home with your family or an all-nighter in the server room at work.</p>
</div>
<div class="paragraph">
<p>In this lesson, we will discuss the tools available to monitor filesystem usage, optimize its operation and how to check and repair damage.</p>
</div>
<div class="sect2">
<h3 id="_checking_disk_usage">Checking Disk Usage</h3>
<div class="paragraph">
<p>There are two commands that can be used to check how much space is being used and how much is left on a filesystem. The first one is <code>du</code>, which stands for &#8220;disk usage&#8221;.</p>
</div>
<div class="paragraph">
<p><code>du</code> is recursive in nature. In its most basic form, the command will simply show how many 1 Kilobyte blocks are being used by the current directory and all its subdirectories:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>du</strong>
4816	.</pre>
</div>
</div>
<div class="paragraph">
<p>This is not very helpful, so we can request more &#8220;human readable&#8221; output by adding the <code>-h</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>du -h</strong>
4.8M	.</pre>
</div>
</div>
<div class="paragraph">
<p>By default, <code>du</code> only shows the usage count for directories (considering all files and subdirectories inside it). To show an individual count for all files in the directory, use the <code>-a</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>du -ah</strong>
432K	./geminoid.jpg
508K	./Linear_B_Hero.jpg
468K	./LG-G8S-ThinQ-Mirror-White.jpg
656K	./LG-G8S-ThinQ-Range.jpg
60K	./Stranger3_Titulo.png
108K	./Baidu_Banho.jpg
324K	./Xiaomi_Mimoji.png
284K	./Mi_CC_9e.jpg
96K	./Mimoji_Comparativo.jpg
32K	./Xiaomi FCC.jpg
484K	./geminoid2.jpg
108K	./Mimoji_Abre.jpg
88K	./Mi8_Hero.jpg
832K	./Tablet_Linear_B.jpg
332K	./Mimoji_Comparativo.png
4.8M	.</pre>
</div>
</div>
<div class="paragraph">
<p>The default behaviour is to show the usage of every subdirectory, then the total usage of the current directory, <em>including</em> subdirectories:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>du -h</strong>
4.8M	./Temp
6.0M	.</pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, we can see that the subdirectory <code>Temp</code> occupies 4.8 MB and the current directory, <em>including</em> <code>Temp</code>, occupies 6.0 MB. But how much space do the <em>files</em> in the current directory occupy, excluding the subdirectories? For that we have the <code>-S</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>du -Sh</strong>
4.8M	./Temp
1.3M	.</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Keep in mind that command line parameters are case-sensitive: <code>-s</code> is different from <code>-S</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to keep this distinction between the space used by the files in the current directory and the space used by subdirectories, but <em>also</em> want a grand total at the end, you can add the <code>-c</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>du -Shc</strong>
4.8M	./Temp
1.3M	.
6.0M	total</pre>
</div>
</div>
<div class="paragraph">
<p>You can control how &#8220;deep&#8221; the output of <code>du</code> should go with the <code>-d N</code> parameter, where <code>N</code> describes the levels. For example, if you use the <code>-d 1</code> parameter, it will show the current directory and its subdirectories, but not the subdirectories of those.</p>
</div>
<div class="paragraph">
<p>See the difference below. Without <code>-d</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>du -h</strong>
216K	./somedir/anotherdir
224K	./somedir
232K	.</pre>
</div>
</div>
<div class="paragraph">
<p>And limiting the depth to one level with <code>-d 1</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>du -h -d1</strong>
224K	./somedir
232K	.</pre>
</div>
</div>
<div class="paragraph">
<p>Please note that even if <code>anotherdir</code> is not being shown, its size is still being taken into account.</p>
</div>
<div class="paragraph">
<p>You may wish to exclude some types of files from the count, which you can do with <code>--exclude="PATTERN"</code>, where <code>PATTERN</code> is the pattern against which you wish to match. Consider this directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>du -ah</strong>
124K	./ASM68K.EXE
2.0M	./Contra.bin
36K	./fixheadr.exe
4.0K	./README.txt
2.1M	./Contra_NEW.bin
4.0K	./Built.bat
8.0K	./Contra_Main.asm
4.2M	.</pre>
</div>
</div>
<div class="paragraph">
<p>Now, we will use <code>--exclude</code> to filter out every file with the <code>.bin</code> extension:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>du -ah --exclude="*.bin"</strong>
124K	./ASM68K.EXE
36K	./fixheadr.exe
4.0K	./README.txt
4.0K	./Built.bat
8.0K	./Contra_Main.asm
180K	.</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the total no longer reflects the size of the excluded files.</p>
</div>
</div>
<div class="sect2">
<h3 id="_checking_for_free_space">Checking for Free Space</h3>
<div class="paragraph">
<p><code>du</code> works at the files level. There is another command that can show you disk usage, and how much space is available, at the filesystem level. This command is <code>df</code>.</p>
</div>
<div class="paragraph">
<p>The command <code>df</code> will provide a list of all of the available (already mounted) filesystems on your system, including their total size, how much space has been used, how much space is available, the usage percentage and where it is mounted:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>df</strong>
Filesystem     1K-blocks      Used Available Use% Mounted on
udev             2943068         0   2943068   0% /dev
tmpfs             595892      2496    593396   1% /run
/dev/sda1      110722904  25600600  79454800  25% /
tmpfs            2979440    951208   2028232  32% /dev/shm
tmpfs               5120         0      5120   0% /run/lock
tmpfs            2979440         0   2979440   0% /sys/fs/cgroup
tmpfs             595888        24    595864   1% /run/user/119
tmpfs             595888       116    595772   1% /run/user/1000
/dev/sdb1          89111      1550     80824   2% /media/carol/part1
/dev/sdb3          83187      1550     75330   3% /media/carol/part3
/dev/sdb2          90827      1921     82045   3% /media/carol/part2
/dev/sdc1      312570036 233740356  78829680  75% /media/carol/Samsung Externo</pre>
</div>
</div>
<div class="paragraph">
<p>However, showing the size in 1 KB blocks is not very user-friendly. Like on <code>du</code>, you can add the <code>-h</code> parameters to get a more &#8220;human readable&#8221; output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>df -h</strong>
Filesystem      Size  Used Avail Use% Mounted on
udev            2.9G     0  2.9G   0% /dev
tmpfs           582M  2.5M  580M   1% /run
/dev/sda1       106G   25G   76G  25% /
tmpfs           2.9G  930M  2.0G  32% /dev/shm
tmpfs           5.0M     0  5.0M   0% /run/lock
tmpfs           2.9G     0  2.9G   0% /sys/fs/cgroup
tmpfs           582M   24K  582M   1% /run/user/119
tmpfs           582M  116K  582M   1% /run/user/1000
/dev/sdb1        88M  1.6M   79M   2% /media/carol/part1
/dev/sdb3        82M  1.6M   74M   3% /media/carol/part3
/dev/sdb2        89M  1.9M   81M   3% /media/carol/part2
/dev/sdc1       299G  223G   76G  75% /media/carol/Samsung Externo</pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the <code>-i</code> parameter to show used/available inodes instead of blocks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>df -i</strong>
Filesystem      Inodes  IUsed   IFree IUse% Mounted on
udev            737142    547  736595    1% /dev
tmpfs           745218    908  744310    1% /run
/dev/sda6      6766592 307153 6459439    5% /
tmpfs           745218    215  745003    1% /dev/shm
tmpfs           745218      4  745214    1% /run/lock
tmpfs           745218     18  745200    1% /sys/fs/cgroup
/dev/sda1        62464    355   62109    1% /boot
tmpfs           745218     43  745175    1% /run/user/1000</pre>
</div>
</div>
<div class="paragraph">
<p>One useful parameter is <code>-T</code>, which will also print the type of each filesystem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>df -hT</strong>
Filesystem     Type      Size  Used Avail Use% Mounted on
udev           devtmpfs  2.9G     0  2.9G   0% /dev
tmpfs          tmpfs     582M  2.5M  580M   1% /run
/dev/sda1      ext4      106G   25G   76G  25% /
tmpfs          tmpfs     2.9G  930M  2.0G  32% /dev/shm
tmpfs          tmpfs     5.0M     0  5.0M   0% /run/lock
tmpfs          tmpfs     2.9G     0  2.9G   0% /sys/fs/cgroup
tmpfs          tmpfs     582M   24K  582M   1% /run/user/119
tmpfs          tmpfs     582M  116K  582M   1% /run/user/1000
/dev/sdb1      ext4       88M  1.6M   79M   2% /media/carol/part1
/dev/sdb3      ext4       82M  1.6M   74M   3% /media/carol/part3
/dev/sdb2      ext4       89M  1.9M   81M   3% /media/carol/part2
/dev/sdc1      fuseblk   299G  223G   76G  75% /media/carol/Samsung Externo</pre>
</div>
</div>
<div class="paragraph">
<p>Knowing the type of the filesystem you can filter the output. You can show only filesystems of a given type with <code>-t TYPE</code>, or exclude filesystems of a given type with <code>-x TYPE</code>, like in the examples below.</p>
</div>
<div class="paragraph">
<p>Excluding <code>tmpfs</code> filesystems:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>df -hx tmpfs</strong>
Filesystem      Size  Used Avail Use% Mounted on
udev            2.9G     0  2.9G   0% /dev
/dev/sda1       106G   25G   76G  25% /
/dev/sdb1        88M  1.6M   79M   2% /media/carol/part1
/dev/sdb3        82M  1.6M   74M   3% /media/carol/part3
/dev/sdb2        89M  1.9M   81M   3% /media/carol/part2
/dev/sdc1       299G  223G   76G  75% /media/carol/Samsung Externo</pre>
</div>
</div>
<div class="paragraph">
<p>Showing only <code>ext4</code> filesystems:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>df -ht ext4</strong>
Filesystem      Size  Used Avail Use% Mounted on
/dev/sda1       106G   25G   76G  25% /
/dev/sdb1        88M  1.6M   79M   2% /media/carol/part1
/dev/sdb3        82M  1.6M   74M   3% /media/carol/part3
/dev/sdb2        89M  1.9M   81M   3% /media/carol/part2</pre>
</div>
</div>
<div class="paragraph">
<p>You can also customize the output of <code>df</code>, selecting what should be displayed and in which order, using the <code>--output=</code> parameter followed by a comma separated list of fields you wish to display. Some of the available fields are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>source</code></dt>
<dd>
<p>The device corresponding to the filesystem.</p>
</dd>
<dt class="hdlist1"><code>fstype</code></dt>
<dd>
<p>The filesystem type.</p>
</dd>
<dt class="hdlist1"><code>size</code></dt>
<dd>
<p>The total size of the filesystem.</p>
</dd>
<dt class="hdlist1"><code>used</code></dt>
<dd>
<p>How much space is being used.</p>
</dd>
<dt class="hdlist1"><code>avail</code></dt>
<dd>
<p>How much space is available.</p>
</dd>
<dt class="hdlist1"><code>pcent</code></dt>
<dd>
<p>The usage percentage.</p>
</dd>
<dt class="hdlist1"><code>target</code></dt>
<dd>
<p>Where the filesystem is mounted (mount point).</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If you want an output showing the target, source, type and usage, you can use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>df -h --output=target,source,fstype,pcent</strong>
Mounted on                    Filesystem     Type     Use%
/dev                          udev           devtmpfs   0%
/run                          tmpfs          tmpfs      1%
/                             /dev/sda1      ext4      25%
/dev/shm                      tmpfs          tmpfs     32%
/run/lock                     tmpfs          tmpfs      0%
/sys/fs/cgroup                tmpfs          tmpfs      0%
/run/user/119                 tmpfs          tmpfs      1%
/run/user/1000                tmpfs          tmpfs      1%
/media/carol/part1            /dev/sdb1      ext4       2%
/media/carol/part3            /dev/sdb3      ext4       3%
/media/carol/part2            /dev/sdb2      ext4       3%
/media/carol/Samsung Externo  /dev/sdc1      fuseblk   75%</pre>
</div>
</div>
<div class="paragraph">
<p><code>df</code> can also be used to check inode information, by passing the following fields to <code>--output=</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>itotal</code></dt>
<dd>
<p>The total number of inodes in the filesystem.</p>
</dd>
<dt class="hdlist1"><code>iused</code></dt>
<dd>
<p>The number of used inodes in the filesystem.</p>
</dd>
<dt class="hdlist1"><code>iavail</code></dt>
<dd>
<p>The number of available inodes in the filesystem.</p>
</dd>
<dt class="hdlist1"><code>ipcent</code></dt>
<dd>
<p>The percentage of used inodes in the filesystem.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>df --output=source,fstype,itotal,iused,ipcent</strong>
Filesystem     Type      Inodes  IUsed IUse%
udev           devtmpfs  735764    593    1%
tmpfs          tmpfs     744858   1048    1%
/dev/sda1      ext4     7069696 318651    5%
tmpfs          tmpfs     744858    222    1%
tmpfs          tmpfs     744858      3    1%
tmpfs          tmpfs     744858     18    1%
tmpfs          tmpfs     744858     22    1%
tmpfs          tmpfs     744858     40    1%</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_maintaining_ext2_ext3_and_ext4_filesystems">Maintaining ext2, ext3 and ext4 Filesystems</h3>
<div class="paragraph">
<p>To check a filesystem for errors (and hopefully fix them), Linux provides the <code>fsck</code> utility (think of &#8220;filesystem check&#8221; and you will never forget the name). In its most basic form, you can invoke it with <code>fsck</code> followed by the filesystem&#8217;s location you want to check:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># <strong>fsck /dev/sdb1</strong>
fsck from util-linux 2.33.1
e2fsck 1.44.6 (5-Mar-2019)
DT_2GB: clean, 20/121920 files, 369880/487680 blocks</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>NEVER run <code>fsck</code> (or related utilities) on a mounted filesystem. If this is done anyway, data may be lost.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>fsck</code> itself will not check the filesystem, it will merely call the appropriate utility for the filesystem type to do so. In the example above, since a filesystem type was not specified, <code>fsck</code> assumed an ext2/3/4 filesystem by default, and called <code>e2fsck</code>.</p>
</div>
<div class="paragraph">
<p>To specify a filesystem, use the <code>-t</code> option, followed by the filesystem name, like in <code>fsck -t vfat /dev/sdc</code>. Alternatively, you may call a filesystem-specific utility directly, like <code>fsck.msdos</code> for FAT filesystems.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Type <code>fsck</code> followed by <kbd>Tab</kbd> twice to see a list of all related commands on your system.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>fsck</code> can take some command-line arguments. These are some of the most common:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-A</code></dt>
<dd>
<p>This will check all filesystems listed in <code>/etc/fstab</code>.</p>
</dd>
<dt class="hdlist1"><code>-C</code></dt>
<dd>
<p>Displays a progress bar when checking a filesystem. Currently only works on ext2/3/4 filesystems.</p>
</dd>
<dt class="hdlist1"><code>-N</code></dt>
<dd>
<p>This will print what would be done and exit, without actually checking the filesystem.</p>
</dd>
<dt class="hdlist1"><code>-R</code></dt>
<dd>
<p>When used in conjunction with <code>-A</code>, this will skip checking the root filesystem.</p>
</dd>
<dt class="hdlist1"><code>-V</code></dt>
<dd>
<p>Verbose mode, prints more information than usual during operation. This is useful for debugging.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The specific utility for ext2, ext3 and ext4 filesystems is <code>e2fsck</code>, also called <code>fsck.ext2</code>, <code>fsck.ext3</code> and <code>fsck.ext4</code> (those three are merely links to <code>e2fsck</code>). By default, it runs in interactive mode: when a filesystem error is found, it stops and asks the user what to do. The user must type <code>y</code> to fix the problem, <code>n</code> to leave it unfixed or <code>a</code> to fix the current problem and all subsequent ones.</p>
</div>
<div class="paragraph">
<p>Of course sitting in front of a terminal waiting for <code>e2fsck</code> to ask what to do is not a productive use of your time, especially if you are dealing with a big filesystem. So, there are options that cause <code>e2fsck</code> to run in non-interactive mode:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-p</code></dt>
<dd>
<p>This will attempt to automatically fix any errors found. If an error that requires intervention from the system administrator is found, <code>e2fsck</code> will provide a description of the problem and exit.</p>
</dd>
<dt class="hdlist1"><code>-y</code></dt>
<dd>
<p>This will answer <code>y</code> (yes) to all questions.</p>
</dd>
<dt class="hdlist1"><code>-n</code></dt>
<dd>
<p>The opposite of <code>-y</code>. Besides answering <code>n</code> (no) to all questions, this will cause the filesystem to be mounted read-only, so it cannot be modified.</p>
</dd>
<dt class="hdlist1"><code>-f</code></dt>
<dd>
<p>Forces <code>e2fsck</code> to check a filesystem even if is marked as &#8220;clean&#8221;, i.e. has been correctly unmounted.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_fine_tuning_an_ext_filesystem">Fine Tuning an ext Filesystem</h4>
<div class="paragraph">
<p>ext2, ext3 and ext4 filesystems have a number of parameters that can be adjusted, or &#8220;tuned&#8221;, by the system administrator to better suit the system needs. The utility used to display or modify these parameters is called <code>tune2fs</code>.</p>
</div>
<div class="paragraph">
<p>To see the current parameters for any given filesystem, use the <code>-l</code> parameter followed by the device representing the partition. The example below shows the output of this command on the first partition of the first disk (<code>/dev/sda1</code>) of a machine:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># <strong>tune2fs -l /dev/sda1</strong>
tune2fs 1.44.6 (5-Mar-2019)
Filesystem volume name:   &lt;none&gt;
Last mounted on:          /
Filesystem UUID:          6e2c12e3-472d-4bac-a257-c49ac07f3761
Filesystem magic number:  0xEF53
Filesystem revision #:    1 (dynamic)
Filesystem features:      has_journal ext_attr resize_inode dir_index filetype needs_recovery extent 64bit flex_bg sparse_super large_file huge_file dir_nlink extra_isize metadata_csum
Filesystem flags:         signed_directory_hash
Default mount options:    user_xattr acl
Filesystem state:         clean
Errors behavior:          Continue
Filesystem OS type:       Linux
Inode count:              7069696
Block count:              28255605
Reserved block count:     1412780
Free blocks:              23007462
Free inodes:              6801648
First block:              0
Block size:               4096
Fragment size:            4096
Group descriptor size:    64
Reserved GDT blocks:      1024
Blocks per group:         32768
Fragments per group:      32768
Inodes per group:         8192
Inode blocks per group:   512
Flex block group size:    16
Filesystem created:       Mon Jun 17 13:49:59 2019
Last mount time:          Fri Jun 28 21:14:38 2019
Last write time:          Mon Jun 17 13:53:39 2019
Mount count:              8
Maximum mount count:      -1
Last checked:             Mon Jun 17 13:49:59 2019
Check interval:           0 (&lt;none&gt;)
Lifetime writes:          20 GB
Reserved blocks uid:      0 (user root)
Reserved blocks gid:      0 (group root)
First inode:              11
Inode size:	          256
Required extra isize:     32
Desired extra isize:      32
Journal inode:            8
First orphan inode:       5117383
Default directory hash:   half_md4
Directory Hash Seed:      fa95a22a-a119-4667-a73e-78f77af6172f
Journal backup:           inode blocks
Checksum type:            crc32c
Checksum:                 0xe084fe23</pre>
</div>
</div>
<div class="paragraph">
<p>ext filesystems have <em>mount counts</em>. The count is increased by 1 each time the filesystem is mounted, and when a threshold value (the <em>maximum mount count</em>) is reached the system will be automatically checked with <code>e2fsck</code> on the next boot.</p>
</div>
<div class="paragraph">
<p>The maximum mount count can be set with the <code>-c N</code> parameter, where <code>N</code> is the number of times the filesystem can be mounted without being checked. The <code>-C N</code> parameter sets the number of times the system has been mounted to the value of <code>N</code>. Note that command line parameters are case-sensitive, so <code>-c</code> is different from <code>-C</code>.</p>
</div>
<div class="paragraph">
<p>It is also possible to define a time interval between checks, with the <code>-i</code> parameter, followed by a number and the letters <code>d</code> for days, <code>m</code> for months and <code>y</code> for years. For example, <code>-i 10d</code> would check the filesystem at the next reboot every 10 days. Use zero as the value to disable this feature.</p>
</div>
<div class="paragraph">
<p><code>-L</code> can be used to set a label for the filesystem. This label can have up to 16 characters. The <code>-U</code> parameter sets the UUID for the filesystem, which is a 128 bit hexadecimal number. In the example above, the UUID is <code>6e2c12e3-472d-4bac-a257-c49ac07f3761</code>. Both the label and UUID can be used instead of the device name (like <code>/dev/sda1</code>) to mount the filesystem.</p>
</div>
<div class="paragraph">
<p>The option <code>-e BEHAVIOUR</code> defines the kernel behaviour when a filesystem error is found. There are three possible behaviours:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>continue</code></dt>
<dd>
<p>Will continue execution normally.</p>
</dd>
<dt class="hdlist1"><code>remount-ro</code></dt>
<dd>
<p>Will remount the filesystem as read-only.</p>
</dd>
<dt class="hdlist1"><code>panic</code></dt>
<dd>
<p>Will cause a kernel panic.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The default behaviour is to <code>continue</code>. <code>remount-ro</code> might be useful in data-sensitive applications, as it will immediately stop writes to the disk, avoiding more potential errors.</p>
</div>
<div class="paragraph">
<p>ext3 filesystems are basically ext2 filesystems with a journal. Using <code>tune2fs</code> you can add a journal to an ext2 filesystem, thus converting it to ext3. The procedure is simple, just pass the <code>-j</code> parameter to <code>tune2fs</code>, followed by the device containing the filesystem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># <strong>tune2fs -j /dev/sda1</strong></pre>
</div>
</div>
<div class="paragraph">
<p>Afterwards, when mounting the converted filesystem, do not forget to set the type to <code>ext3</code> so the journal can be used.</p>
</div>
<div class="paragraph">
<p>When dealing with journaled filesystems, the <code>-J</code> parameter allows you to use extra parameters to set some journal options, like <code>-J size=</code> to set the journal size (in megabytes), <code>-J location=</code> to specify where the journal should be stored (either a specific block, or a specific position on the disk with suffixes like <code>M</code> or <code>G</code>) and even put the journal on an external device with <code>-J device=</code>.</p>
</div>
<div class="paragraph">
<p>You can specify multiple parameters at once by separating them with a comma. For example: <code>-J size=10,location=100M,device=/dev/sdb1</code> will create a 10 MB Journal at the 100 MB position on the device <code>/dev/sdb1</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p><code>tune2fs</code> has a &#8220;brute force&#8221; option, <code>-f</code>, which will force it to complete an operation even if errors are found. Needless to say, this should be only used with extreme caution.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_maintaining_xfs_filesystems">Maintaining XFS Filesystems</h4>
<div class="paragraph">
<p>For XFS filesystems, the equivalent of <code>fsck</code> is <code>xfs_repair</code>. If you suspect that something is wrong with the filesystem, the first thing to do is to scan it for damage.</p>
</div>
<div class="paragraph">
<p>This can be done by passing the <code>-n</code> parameter to <code>xfs_repair</code>, followed by the device containing the filesystem. The <code>-n</code> parameter means &#8220;no modify&#8221;: the filesystem will be checked, errors will be reported but no repairs will be made:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># <strong>xfs_repair -n /dev/sdb1</strong>
Phase 1 - find and verify superblock...
Phase 2 - using internal log
        - zero log...
        - scan filesystem freespace and inode maps...
        - found root inode chunk
Phase 3 - for each AG...
        - scan (but do not clear) agi unlinked lists...
        - process known inodes and perform inode discovery...
        - agno = 0
        - agno = 1
        - agno = 2
        - agno = 3
        - process newly discovered inodes...
Phase 4 - check for duplicate blocks...
        - setting up duplicate extent list...
        - check for inodes claiming duplicate blocks...
        - agno = 1
        - agno = 3
        - agno = 0
        - agno = 2
No modify flag set, skipping phase 5
Phase 6 - check inode connectivity...
        - traversing filesystem ...
        - traversal finished ...
        - moving disconnected inodes to lost+found ...
Phase 7 - verify link counts...
No modify flag set, skipping filesystem flush and exiting.</pre>
</div>
</div>
<div class="paragraph">
<p>If errors are found, you can proceed to do the repairs without the <code>-n</code> parameter, like so: <code>xfs_repair /dev/sdb1</code>.</p>
</div>
<div class="paragraph">
<p><code>xfs_repair</code> accepts a number of command line options. Among them:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-l LOGDEV</code> and <code>-r RTDEV</code></dt>
<dd>
<p>These are needed if the filesystem has external log and realtime sections. In this case, replace <code>LOGDEV</code> and <code>RTDEV</code> with the corresponding devices.</p>
</dd>
<dt class="hdlist1"><code>-m N</code></dt>
<dd>
<p>Is used to limit the memory usage of <code>xfs_repair</code> to <code>N</code> megabytes, something which can be useful on server settings. According to the man page, by default <code>xfs_repair</code> will scale its memory usage as needed, up to 75% of the system&#8217;s physical RAM.</p>
</dd>
<dt class="hdlist1"><code>-d</code></dt>
<dd>
<p>The &#8220;dangerous&#8221; mode will enable the repair of filesystems that are mounted read-only.</p>
</dd>
<dt class="hdlist1"><code>-v</code></dt>
<dd>
<p>You may have guessed it: verbose mode. Each time this parameter is used, the &#8220;verbosity&#8221; is increased (for example, <code>-v -v</code> will print more information than just <code>-v</code>).</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Note that <code>xfs_repair</code> is unable to repair filesystems with a &#8220;dirty&#8221; log. You can &#8220;zero out&#8221; a corrupt log with the <code>-L</code> parameter, but keep in mind that this is a <em>last resort</em> as it may result in filesystem corruption and data loss.</p>
</div>
<div class="paragraph">
<p>To debug an XFS filesystem, the utility <code>xfs_db</code> can be used, like in <code>xfs_db /dev/sdb1</code>. This is mostly used to inspect various elements and parameters of the filesystem.</p>
</div>
<div class="paragraph">
<p>This utility has an interactive prompt, like <code>parted</code>, with many internal commands. A help system is also available: type <code>help</code> to see a list of all commands, and <code>help</code> followed by the command name to see more information about the command.</p>
</div>
<div class="paragraph">
<p>Another useful utility is <code>xfs_fsr</code>, which can be used to reorganize (&#8220;defragment&#8221;) an XFS filesystem. When executed without any extra arguments it will run for two hours and try to defragment all mounted, writable XFS filesystems listed on the <code>/etc/mtab/</code> file. You may need to install this utility using the package manager for your Linux distribution, as it may not be part of a default install. For more information consult the corresponding man page.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sec.104.2_01-GE">Guided Exercises</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Using <code>du</code>, how can we check how much space is being used by just the files on the current directory?</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Using <code>df</code>, list information for every ext4 filesystem, with the outputs including the following fields, in order: device, mount point, total number of inodes, number of available inodes, percentage of free space.</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>What is the command to run <code>e2fsck</code> on <code>/dev/sdc1</code> in non-interactive mode, while trying to automatically fix most errors?</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Suppose <code>/dev/sdb1</code> is an ext2 filesystem. How can you convert it to ext3, and at the same time reset its mount count and change its label to <code>UserData</code>?</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>How can you check for errors on an XFS filesystem, <em>without</em> repairing any damage found?</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sec.104.2_01-EE">Explorational Exercises</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Consider you have an ext4 filesystem on <code>/dev/sda1</code> with the following parameters, obtained with <code>tune2fs</code>:</p>
<div class="listingblock">
<div class="content">
<pre>Mount count:              8
Maximum mount count:      -1</pre>
</div>
</div>
<div class="paragraph">
<p>What will happen at the next boot if the command <code>tune2fs -c 9 /dev/sda1</code> is issued?</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Consider the following output of <code>du -h</code>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>du -h</strong>
216K	./somedir/anotherdir
224K	./somedir
232K	.</pre>
</div>
</div>
<div class="paragraph">
<p>How much space is occupied by just the files on the current directory? How could we rewrite the command to show this information more clearly?</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>What would happen to the ext2 filesystem <code>/dev/sdb1</code> if the command below is issued?</p>
<div class="listingblock">
<div class="content">
<pre># <strong>tune2fs -j /dev/sdb1 -J device=/dev/sdc1 -i 30d</strong></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>How can we check for errors on a XFS filesystem on <code>/dev/sda1</code> that has a log section on <code>/dev/sdc1</code>, without actually making any repairs?</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>What is the difference between the <code>-T</code> and <code>-t</code> parameters for <code>df</code>?</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sec.104.2_01-SU">Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this lesson, you learned:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How to check for used and free space on a filesystem.</p>
</li>
<li>
<p>How to tailor the output of <code>df</code> to suit your needs.</p>
</li>
<li>
<p>How to check the integrity of and repair a filesystem with <code>fsck</code> and <code>e2fsck</code>.</p>
</li>
<li>
<p>How to fine tune an ext filesystem with <code>tune2fs</code>.</p>
</li>
<li>
<p>How to check and repair XFS filesystems with <code>xfs_repair</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following commands were discussed in this lesson:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>du</code></dt>
<dd>
<p>View the amount of disk space in use on a filesystem.</p>
</dd>
<dt class="hdlist1"><code>df</code></dt>
<dd>
<p>View the amount of disk space that is available (free) on a filesystem.</p>
</dd>
<dt class="hdlist1"><code>fsck</code></dt>
<dd>
<p>The filesystem check repair utility.</p>
</dd>
<dt class="hdlist1"><code>e2fsck</code></dt>
<dd>
<p>The filesystem check repair utility specific to extended (ext2/3/4) filesystems.</p>
</dd>
<dt class="hdlist1"><code>tune2fs</code></dt>
<dd>
<p>Modifies filesystem parameters on an extended (ext2/3/4) filesystem.</p>
</dd>
<dt class="hdlist1"><code>xfs_repair</code></dt>
<dd>
<p>The equivalent of <code>fsck</code> for XFS filesystems.</p>
</dd>
<dt class="hdlist1"><code>xfs_db</code></dt>
<dd>
<p>This utility is used to view various parameters of an XFS filesystem.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sec.104.2_01-AGE">Answers to Guided Exercises</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Using <code>du</code>, how can we check how much space is being used by just the files on the current directory?</p>
<div class="paragraph">
<p>First, use the <code>-S</code> parameter to separate the output of the current directory from its subdirectories. Then, use <code>-d 0</code> to limit the output depth to zero, meaning &#8220;no subdirectories&#8221;. Do not forget <code>-h</code> to get an output in an &#8220;human-readable&#8221; format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>du -S -h -d 0</strong></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>du -Shd 0</strong></pre>
</div>
</div>
</li>
<li>
<p>Using <code>df</code>, list information for every ext4 filesystem, with the outputs including the following fields, in order: device, mount point, total number of inodes, number of available inodes, percentage of free space.</p>
<div class="paragraph">
<p>You can filter filesystems with the <code>-t</code> option followed by the filesystem name. To get the output needed, use <code>--output=source,target,itotal,iavail,pcent</code>. So, the answer is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>df -t ext4 --output=source,target,itotal,iavail,pcent</strong></pre>
</div>
</div>
</li>
<li>
<p>What is the command to run <code>e2fsck</code> on <code>/dev/sdc1</code> in non-interactive mode, while trying to automatically fix most errors?</p>
<div class="paragraph">
<p>The parameter to automatically try to fix most errors is <code>-p</code>. So the answer is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># <strong>e2fsck -p /dev/sdc1</strong></pre>
</div>
</div>
</li>
<li>
<p>Suppose <code>/dev/sdb1</code> is an ext2 filesystem. How can you convert it to ext3 and at the same time reset its mount count and change its label to <code>UserData</code>?</p>
<div class="paragraph">
<p>Remember that converting an ext2 filesystem to ext3 is just a matter of adding a journal, which can be done with the <code>-j</code> parameter. To reset the mount count, use <code>-c 0</code>. To change the label use <code>-L UserData</code>. The correct answer is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># <strong>tune2fs -j -c 0 -L UserData /dev/sdb1</strong></pre>
</div>
</div>
</li>
<li>
<p>How can you check for errors on an XFS filesystem, <em>without</em> repairing any damage found?</p>
<div class="paragraph">
<p>Use the <code>-n</code> parameter, like in <code>xfs -n</code>, followed by the corresponding device.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sec.104.2_01-AEE">Answers to Explorational Exercises</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Consider you have an ext4 filesystem on <code>/dev/sda1</code> with the following parameters, obtained with <code>tune2fs</code>:</p>
<div class="listingblock">
<div class="content">
<pre>Mount count:              8
Maximum mount count:      -1</pre>
</div>
</div>
<div class="paragraph">
<p>What will happen at the next boot if the command <code>tune2fs -c 9 /dev/sda1</code> is issued?</p>
</div>
<div class="paragraph">
<p>The command will set the maximum mount count for the filesystem to 9. Since it is currently 8, the next system boot will cause a filesystem check.</p>
</div>
</li>
<li>
<p>Consider the following output of <code>du -h</code>:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>du -h</strong>
216K	./somedir/anotherdir
224K	./somedir
232K	.</pre>
</div>
</div>
<div class="paragraph">
<p>How much space is occupied by just the files on the current directory? How could we rewrite the command to show this information more clearly?</p>
</div>
<div class="paragraph">
<p>Of the total of 232 K used, 224 K are used by the subdirectory <code>somedir</code> and its subdirectories. So, excluding those, we have 8K being occupied by the files on the current directory. This information can be shown more clearly by using the <code>-S</code> parameter, which will separate the directories in the count.</p>
</div>
</li>
<li>
<p>What would happen to the ext2 filesystem <code>/dev/sdb1</code> if the command below is issued?</p>
<div class="listingblock">
<div class="content">
<pre># <strong>tune2fs -j /dev/sdb1 -J device=/dev/sdc1 -i 30d</strong></pre>
</div>
</div>
<div class="paragraph">
<p>A journal will be added to <code>/dev/sdb1</code>, converting it to ext3. The journal will be stored on the device <code>/dev/sdc1</code> and the filesystem will be checked every 30 days.</p>
</div>
</li>
<li>
<p>How can we check for errors on a XFS filesystem on <code>/dev/sda1</code> that has a log section on <code>/dev/sdc1</code>, without actually making any repairs?</p>
<div class="paragraph">
<p>Use <code>xfs_repair</code>, followed by <code>-l /dev/sdc1</code> to indicate the device containing the log section, and <code>-n</code> to avoid making any changes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># <strong>xfs_repair -l /dev/sdc1 -n</strong></pre>
</div>
</div>
</li>
<li>
<p>What is the difference between the <code>-T</code> and <code>-t</code> parameters for <code>df</code>?</p>
<div class="paragraph">
<p>The parameter <code>-T</code> will include the type of each filesystem in the output of <code>df</code>. <code>-t</code> is a filter, and will show only filesystems of the given type on the output, excluding all others.</p>
</div>
</li>
</ol>
</div>
</div>
</div>

        
      </section>
    </div>

    <aside class="lesson__license smallprint">
  <div class="container">
    
    <p>© 2020 Linux Professional Insitute Inc. All rights reserved. Visit the Learning Materials website: https://learning.lpi.org<br />
       This work is licensed under the Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License.</p>
  </div>
</aside>


    
    
    <aside class="lesson__teaser teaser">
      <div class="container teaser__container">
        <h2 class="label">Next Lesson</h2>
        <p class="headline teaser__headline">104.3 Control mounting and unmounting of filesystems (104.3 Lesson 1)</p>

        <div class="button-group">
            <a href="../../104.3/104.3_01/index.html" class="button -primary">Read next lesson</a>
        </div>
      </div>
    </aside>
    
  </div>
</div>

<div class="lesson-progress">
  <div class="lesson-progress__current"></div>
</div>

      </main>
    </td></tr></tbody>
    <tfoot><tr><td class="print__cell">
      <div class="print__space -footer"></div>
    </td></tr></tfoot>
  </table>

  <table class="print-footer">
  <tr class="print-footer__body">
    <td class="print-footer__cell -image">
      <img src="index.html" alt="" class="print-footer__image">
    </td>
    <td class="print-footer__cell -center">
      <p>© 2020 Linux Professional Insitute Inc. All rights reserved. Visit the Learning Materials website: https://learning.lpi.org<br />
         This work is licensed under the Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License.</p>
    </td>
    <td class="print-footer__cell -image">
      <img src="index.html" alt="" class="print-footer__license">
    </td>
  </tr>
</table>

<footer class="footer">
  <div class="container footer__container columns">
    <div class="column">
      <h2>LPI is a non-profit organization.</h2>
      <p>Linux Professional Institute (LPI) is the global certification standard and career support organization for open source professionals. With more than 200,000 certification holders, it&#39;s the world’s first and largest vendor-neutral Linux and open source certification body. LPI has certified professionals in over 180 countries, delivers exams in multiple languages, and has hundreds of training partners.</p>
      <p>Our purpose is to enable economic and creative opportunities for everybody by making open source knowledge and skills certification universally accessible.</p>
    </div>

    <div class="column">
      <ul class="footer__social social">
        <li class="social__item -linkedin">
          <a class="social__link" href="https://www.linkedin.com/company/35136" target="_blank" rel="noreferrer">
            <svg version="1.1"  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 42.3 36" enable-background="new 0 0 42.3 36" xml:space="preserve">
<g>
	<g>
		<g>
			<path fill="#010202" d="M33.3,0H2.7C1.2,0,0,1.2,0,2.6v30.8C0,34.8,1.2,36,2.7,36h30.7c1.5,0,2.7-1.2,2.7-2.6V2.6
				C36,1.2,34.8,0,33.3,0z M10.7,30.7H5.3V13.5h5.3V30.7z M8,11.1c-1.7,0-3.1-1.4-3.1-3.1C4.9,6.3,6.3,5,8,5c1.7,0,3.1,1.4,3.1,3.1
				C11.1,9.8,9.7,11.1,8,11.1z M30.7,30.7h-5.3v-8.4c0-2,0-4.6-2.8-4.6c-2.8,0-3.2,2.2-3.2,4.4v8.5H14V13.5h5.1v2.3h0.1
				c0.7-1.4,2.5-2.8,5.1-2.8c5.4,0,6.4,3.6,6.4,8.2V30.7z"/>
		</g>
	</g>
	<g>
		<polygon fill="#010202" points="37.5,28.5 38.2,28.5 38.2,30.7 38.6,30.7 38.6,28.5 39.3,28.5 39.3,28.1 37.5,28.1 		"/>
		<polygon fill="#010202" points="41.7,28.1 41,30 40.3,28.1 39.7,28.1 39.7,30.7 40.1,30.7 40.1,28.8 40.9,30.7 41.1,30.7
			41.9,28.8 41.9,30.7 42.3,30.7 42.3,28.1 		"/>
	</g>
</g>
</svg>

            <span class="social__link__text">LinkedIn</span>
          </a>
        </li>
        <li class="social__item -facebook">
          <a class="social__link" href="https://www.facebook.com/LPIConnect" target="_blank" rel="noreferrer">
            <svg version="1.1"  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 36 36" enable-background="new 0 0 36 36" xml:space="preserve">
<title>flogo-RGB-HEX-Blk-58</title>
<path d="M34,0H2C0.9,0,0,0.9,0,2v32c0,1.1,0.9,2,2,2h17.3V22.1h-4.7v-5.4h4.7v-4c0-4.6,2.8-7.2,7-7.2c0,0,0,0,0,0c0,0,0,0,0,0
	c0.4,0,0.9,0,1.3,0c0.3,0,0.5,0,0.8,0c0.7,0,1.4,0.1,2.1,0.2v4.9v0h-2.9c-0.3,0-0.5,0-0.8,0c-1.6,0.2-1.9,1.2-1.9,2.6v3.5h5.4
	l-0.7,5.4h0l0,0h-4.7V36H34c1.1,0,2-0.9,2-2V2C36,0.9,35.1,0,34,0z"/>
</svg>

            <span class="social__link__text">Facebook</span>
          </a>
        </li>
        <li class="social__item -twitter">
          <a class="social__link" href="https://twitter.com/lpiconnect" target="_blank" rel="noreferrer">
            <svg version="1.1" id="Logo_FIXED" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 36 36" enable-background="new 0 0 36 36" xml:space="preserve">
<path d="M11.3,32.6c13.6,0,21-11.3,21-21c0-0.3,0-0.6,0-1c1.4-1,2.7-2.3,3.7-3.8c-1.3,0.6-2.8,1-4.2,1.2c1.5-0.9,2.7-2.4,3.2-4.1
	c-1.4,0.9-3,1.5-4.7,1.8c-2.8-3-7.5-3.1-10.5-0.3c-1.9,1.8-2.7,4.5-2.1,7.1C11.8,12.1,6.3,9.3,2.5,4.7c-2,3.4-1,7.7,2.3,9.9
	c-1.2,0-2.3-0.4-3.4-0.9c0,0,0,0.1,0,0.1c0,3.5,2.5,6.5,5.9,7.2c-1.1,0.3-2.2,0.3-3.3,0.1c1,3,3.7,5.1,6.9,5.1
	c-2.6,2.1-5.8,3.2-9.2,3.2c-0.6,0-1.2,0-1.8-0.1C3.4,31.5,7.3,32.6,11.3,32.6"/>
</svg>

            <span class="social__link__text">Twitter</span>
          </a>
        </li>
      </ul>
    </div>
  </div>

  <div class="container footer__secondary">
    <ul class="footer__links">
      <li><a href="https://www.lpi.org/about-lpi/contact-us" class="footer__link" target="_blank" rel="noreferrer">Contact Us</a></li>
      <li><a href="https://www.lpi.org/privacy-and-cookie-policy" class="footer__link" target="_blank" rel="noreferrer">Privacy and Cookie Policy</a></li>
    </ul>

    <p><strong>Spot a mistake or want to help improve this page? Please <a href="https://www.lpi.org/about-lpi/contact-us" target="_blank" rel="noreferrer">let us know</a>.</strong></p>
    <p>© Copyright 1999-2020 The Linux Professional Institute Inc. All rights reserved.</p>
  </div>
</footer>


  
  
  

  <script src="https://unpkg.com/swiper/swiper-bundle.min.js" type="application/javascript"></script>
  <script src="../../../../../../js/bundle.js"></script>
</body>
</html>
